# 锁
一致性非锁定读和一致性锁定读
1、共享锁 
2、排他锁
3、独占锁 
4、意向锁
5、间隙锁
6、自增锁

# 锁的粒度
1、行 
2、页
3、表

innodb只有行锁跟表锁，无索引只会加表锁，不会锁行。默认6字节rowid主键

间隙锁解决幻读

next key lock
唯一索引，间隙锁退化成行锁

# binlog、慢查询日志
undo log 实现mvcc

死锁情况下，超时等待后undolog比较少的会释放资源，或者等待图wait for graphy检测，深度优先检测。


# 原子性实现原理

通过undo log实现，先将数据备份到一个地方，然后进行修改数据，如果出现error或者用户rollback则通过undo log回滚数据。逻辑日志与物理日志。
mvcc也通过undolog实现，实际读取的是undolog中的数据

读取通过页来读取，通常4kb或8kb，扇区512b。

# 持久性实现原理

redolog
丁奇mysql

幻读就是a事务插入数据，b事务插入时约束冲突

hash扰动处理

# 树
- bst二叉查找树
- avl二叉平衡树 最小子树 最长子树层高差小于1， 牺牲了插入性能
- 红黑树 最小子树 最长子树层高差小于2倍，平衡了插入性能以及查询性能
- B树，Balance，多叉平衡树
- B+树，非叶子节点不存储data，3-4层，3-4次io即可取到数据，叶子节点为双向链表，方便范围查询

# 聚簇索引 非聚簇索引
- 主键
- 唯一索引
- 6b rowid

主键自增，叶子节点直接尾插入，降低排序，否则出现页分裂，页合并


# 索引分类
- 主键索引 无空值
- 辅助索引
覆盖索引不会回表
- 唯一索引 有空值
- 全文索引

- 组合索引
最左匹配原则，不能用or

索引下推
谓词下推
计算向数据移动，主要是filter从server端挪动到存储引擎


# 优化策略
1、看执行计划
show profile all for query 1 \G


# 范式

# mysql MTS

# 分库分表
- 垂直区分
- 水平区分


